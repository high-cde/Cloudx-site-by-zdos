<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <title>CloudX Civic Lab</title>
  <link rel="stylesheet" href="style.css">

  <!-- Ethers.js per MetaMask -->
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.min.js"></script>
</head>

<body>

<div class="scanline"></div>

<header class="hero">
  <h1 class="title">CLOUDX CIVIC LAB</h1>
  <p class="subtitle">La piattaforma civile per lavoro, studio e collaborazione.</p>

  <div class="cta-container">
    <button id="connectWallet" class="cta">Connetti MetaMask</button>
    <p id="walletAddress"></p>
  </div>
</header>

<section class="section" id="about">
  <h2>Cos'è CloudX</h2>
  <p>
    CloudX è un ecosistema civile che unisce professionisti, clienti e studenti
    in un ambiente meritocratico alimentato da
    <span class="dsn">DSN</span> e governato da
    <span class="hk">Dr HighKali</span>.
  </p>
</section>

<section class="section" id="dsn">
  <h2>Come guadagnare DSN</h2>
  <ul>
    <li>Contributi ai progetti</li>
    <li>Studio e percorsi formativi</li>
    <li>Partecipazione alla community</li>
    <li>Uptime hosting</li>
    <li>Engagement</li>
  </ul>
</section>

<section class="section" id="roles">
  <h2>I Ruoli</h2>
  <div class="roles-grid">
    <div class="role-card">
      <h3>Professionista</h3>
      <p>Crea, collabora, guadagna DSN e costruisci reputazione verificata.</p>
    </div>
    <div class="role-card">
      <h3>Cliente</h3>
      <p>Pubblica job, trova talenti e partecipa all’economia civile.</p>
    </div>
    <div class="role-card">
      <h3>Studente</h3>
      <p>Impara, contribuisci e sali di livello nel sistema CloudX.</p>
    </div>
  </div>
</section>

<section class="section" id="terminal">
  <h2>Terminale CloudX / ZDOS</h2>

  <div class="terminal">
    <div class="terminal-header">
      <span class="dot red"></span>
      <span class="dot yellow"></span>
      <span class="dot green"></span>
      <span class="term-title">zdos@cloudx:~</span>
    </div>

    <div class="terminal-body" id="terminal-output">
      <p>CloudX Civic Lab Terminal v1.0</p>
      <p>Digitare <span class="cmd">help</span> per vedere i comandi disponibili.</p>
    </div>

    <div class="terminal-input">
      <span class="prompt">></span>
      <input id="terminal-input" type="text" autocomplete="off" />
    </div>
  </div>
</section>

<section class="section" id="wallet">
  <h2>DSN Wallet</h2>

  <div class="wallet">
    <div class="wallet-balance">
      <h3>Saldo DSN</h3>
      <p id="dsn-balance">0.00</p>
    </div>

    <div class="wallet-actions">
      <button onclick="loadDSNBalance()">Aggiorna Saldo</button>
    </div>

    <div class="wallet-log" id="wallet-log">
      <p>[LOG] Wallet inizializzato.</p>
    </div>
  </div>
</section>

<section class="section" id="join">
  <h2>Unisciti al progetto</h2>
  <p>Segui il repository, apri una issue o proponi un contributo.</p>
  <a class="repo-link" href="https://github.com/high-cde/Cloudx-site-by-zdos">
    Vai al repository
  </a>
</section>

<footer>
  <p>© 2026 CloudX Civic Lab — Powered by ZDOS</p>
</footer>

<script>
  let userAddress = null;

  async function connectWallet() {
    if (typeof window.ethereum === "undefined") {
      alert("MetaMask non è installato.");
      return;
    }

    try {
      const accounts = await window.ethereum.request({
        method: "eth_requestAccounts"
      });

      userAddress = accounts[0];
      document.getElementById("walletAddress").innerText =
        "Wallet connesso: " + userAddress;

      log("[WALLET] Connesso: " + userAddress);

      setTimeout(loadDSNBalance, 1000);

    } catch (err) {
      console.error(err);
    }
  }

  document.getElementById("connectWallet")
    .addEventListener("click", connectWallet);

  const DSN_TOKEN = "INSERISCI_CONTRACT_ADDRESS";

  const ERC20_ABI = [
    {
      "constant": true,
      "inputs": [{"name": "_owner", "type": "address"}],
      "name": "balanceOf",
      "outputs": [{"name": "balance", "type": "uint256"}],
      "type": "function"
    },
    {
      "constant": true,
      "inputs": [],
      "name": "decimals",
      "outputs": [{"name": "", "type": "uint8"}],
      "type": "function"
    }
  ];

  async function loadDSNBalance() {
    if (!userAddress) {
      log("[ERRORE] Connetti prima MetaMask.");
      return;
    }

    try {
      const provider = new ethers.providers.Web3Provider(window.ethereum);
      const contract = new ethers.Contract(
        DSN_TOKEN,
        ERC20_ABI,
        provider
      );

      const decimals = await contract.decimals();
      const rawBalance = await contract.balanceOf(userAddress);
      const balance = rawBalance / (10 ** decimals);

      document.getElementById("dsn-balance").innerText =
        balance.toFixed(2);

      log("[SYNC] Saldo DSN aggiornato dal wallet reale.");

    } catch (err) {
      log("[ERRORE] Impossibile leggere il saldo DSN.");
      console.error(err);
    }
  }

  function log(msg) {
    const logEl = document.getElementById("wallet-log");
    logEl.innerHTML += "<p>" + msg + "</p>";
    logEl.scrollTop = logEl.scrollHeight;
  }
</script>

</body>
</html>
